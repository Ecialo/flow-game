# Flow Game

## Идея

RTS непрямого контролля про долглосрочное планирование.

### Предпосылки
Мне нравится RTS -- планировать игру, анализировать вражеские действия и подстраиваться под его поведение / навязывать ему своё. Однако на мой вкус микрить танчики это не барское занятие. Более того, микро танчиков оставляет не так много времени на ту часть с анализом и построением планов, т.к. зачастую является очень простым, понятным и эффективным способом размена времени и внимания на преимущество на поле.

### Что уже есть в мире?

Игра | Что нравится | Что не очень устраивает
----- | --------- | --------------
Direct strike | Композиции и синергии юнитов, система автомикро с приоритетами, ощущение передавливания, тайминги | Привязка к SCII, отсутствие логистики, манёвров, борьбы за информацию, излишняя реактивность
Supreme Commander | Системы экономики и производства, радиолектронная борьба, логистика, манёвры, система цепочек приказов, масштаб | Pathfinding, микро
Netstorm | Позиционность, композиции и синергии башен | Тетрис

### Что в итоге хочется увидеть?

* Композиции и синергии юнитов
* Борьбу за информацию
* Масштаб, где на подготовку и исполнение планов нужно время
* Баланс между реактивностью и проактивностью
* Манёвры и логистику
* Время партии не больше полутра часов, лучше меньше

## Процесс

Игровой мир представляет из себя граф состоящий из больших и маленьких узлов. В начале игры у каждого игрока под контроллем есть по одному большому узлу. Цель: захватить стартовые узлы всех оппонирующих игроков. Для этого игроки захватывают и удерживают другие узлы, застраивают их, производят юниты и шлют их в атаку.

### Узлы
Существуют два вида узлов: большие и маленькие

* Большой узел. На нём есть слоты под экономические здания, оборонительные здания и под юниты. Возможно есть здания которые строятся на слотах для юнитов (?). Обычно служит базой.
* Маленький узел. На нём есть слоты только под оборонительные здания, и в меньшем количестве. Обычно служит перевалочным пунктом.

Для того чтобы захватить узел нужно чтобы войска добрались до него и сломали или захватили все постройки на нём. Застраивать можно только свои узлы.

### Производство и войска
Слоты под войска оформлены в виде сетки. На сетке размещаются конкретные юниты, которые и формируют очередь заказа. Узел по очереди пытается построить все юниты из очереди. Когда вся очередь готова, отряд выпускается и следует по кратчайшему пути до вражеского стартового узла. Промежуточные узлы пути можно менять. Если по пути есть союзный узел в котором идёт дозаказ, то отряд может подождать какое-то время (какое?) пока узел достроит свой отряд и дальше, слиться с ним и следовать дальше как один. Несформированный отряд и юниты других отрядов ожидающие формирование этого отряда участвуют в обороне узла. Если юниты из несформированного отряда гибнут, то узел пытается доукомплектовать отряд и не выпускает его, пока не укомплектует.

Каждый юнит отмечен одним или более тэгом, имеет скорость, здоровье и атаку (и может что-то ещё). Отряд всегда движется со скоростью равной минимальной скорости её участников. Когда отряд набредает на отряд противника просиходит симуляция боя (как?). Каждый убитый юнит оставляет после себя часть своих ресурсов в виде остова, которая затем может быть использована вновь.

Юнитам можно настраивать приоритеты атак в зависимости от тегов.

#### Полевые инженеры
В армию могут быть включены полевые инженеры. Они отличаются от обычных юнитов тем, что могут перерабатывать остовы в юнитов прямо на поле боя, а так же при захвате узла не разрушать, а захватывать постройки противника (как именно?)

#### Разведка
По умолчанию мы видим только то, что видят юниты. Однако в узлах можно строить радары. Они охватывают некоторую область вокруг себя и подсвечивают на ней юниты указанных тегов. Например радар подсвечивающий теги `A`и `B`, укажет что в области пробегает юнит с тегами `AB`, `A`, `B`. Однако юнит с тегом `AC` он распознает как `A`, а `CD` не увидит вовсе. У юнитов может быть стелс на некотором теге. Тогда юнит считается юнитом с этим тегом, но на радарах не подсвечивается (а может и подсвечивается, но на более сложных условиях).

#### Экономика
В целом экономические здания делятся на производящие и логистические. Производящие производят ресурс на склад узла где они построены. Логистические отправляют ресурсы со склада этого узла в другой узел или забирают ресурсы из некоторого узла или области и тащат в узел, где они построены. Производство юнитов всегда делается за счёт ресурсов на складе узла где они строятся. Потребление ресурсов (сколько максимум можно потратить ресурсов за тик) и производственная мощь (максимум юнитов, которое можно произвести за тик) так же регулируется зданиями в узле.

### Менее сформулированные идеи
* Авиация: транспорт создающий шорткаты, прикрытие
* Макро здания: дальнобойная артиллерия
* Крупные юниты
* Героические юниты

## Техническая часть
Всё планируется делать на Haskell + Reflex + SDL2. 
Причина: я люблю хаскелл, он позволяет писать очень выразительный код и много багов отлавливать на этапе компиляции. Рефлекс даёт довольно крутую абстракцию для фрп, а сдл проверенное временем решение для простой 2д графики + для рефлекса уже есть под него хост. 

Все данные планируется хранить вне кода. В идеале игра должна стать некоторым странным интерпретатором над внешними данными. Это даст возможность быстрой наработки контента как только проект получит хоть какую-то форму. Как формат внешних данных скорее всего будет использоваться dhall.
